# Namespaces

- абстракция над ресурсами в операционной системе;
- в `namespace` находятся системные ресурсы, которые точно зависят от типа `namespace`;
- в настоящее время существует семь типов пространств имён (namespaces): Cgroups, IPC, Network, Mount, PID, User, UTS;
- `namespace` предоставляются самим ядром Linux и уже являются необходимостью для запуска любого процесса в системе;
- два экземпляра `Network namespace` _A_ и _B_ могут содержать различные ресурсы (_A_ содержит _wlan0_, _B_ содержит _eth0_ и отдельную копию таблицы маршрутизации);
- в любой данный момент времени любой процесс _P_ принадлежит ровно одному экземпляру `namespace` каждого типа;
- содержащийся в `namespace` ресурс **не обязательно** представляет собой уникальную копию;
- когда требуется обновить таблицу маршрутизации в системе, Linux показывает копию таблицы маршрутизации `namespace` текущего процесса;
- **в ряде случаев, возникших намеренно или ввиду бреши в безопасности, два и более `namespaces` будут содержать одну и ту же копию, например одного и того же файла**;
- создание новых `namespaces` обычно требует доступа с правами суперпользователя;

Пример 1:

- `Network namespace` включает в себя системные ресурсы, связанные с сетью, такие как сетевые интерфейсы (например, wlan0, eth0), таблицы маршрутизации и т.д.;
- `Mount namespace` включает файлы и каталоги в системе; 
- `PID` содержит ID процессов; 

Показать `namespaces` которым принадлежит процесс:

```shell

ls -l /proc/$$/ns

```

Пример 2:

```shell

sudo unshare -u bash

```

- команда `unshare` запускает программу (опционально) в новом `namespace`; 
- флаг `-u` говорит ей запустить `bash` в новом `UTS namespace`;
- новый процесс `bash` указывает на другой файл `uts`, тогда как все остальные остаются прежними;

## Контейнер

- контейнеры по своей сути - обыкновенные процессы с отличающимися от других процессов `namespaces`; 
- контейнер - квота, контейнер без квот не обязан принадлежать уникальному `namespace` каждого типа - он может совместно использовать некоторые из них;

Пример:

```shell

docker run --net=host redis

```

- создает новый `Network namespace` для процесса `redis`;
- Linux добавит этот процесс участником дефолтного `Network namespace`;

## Изолирование

- чем меньше количество `namespaces` и ресурсов, которые процесс делит с остальными, тем более он изолирован;
- isolate принимает команду в качестве аргументов и запускает её в новом процессе, изолированном от остальной системы и в ограниченном собственными `namespaces`;
