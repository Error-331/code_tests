'use strict';

// external imports

// local imports
const {generateSync} = require('./helpers/promise_sync_helpers');
const {getDBEffects} = require('./helpers/db_helpers');

const {setMasterProcessType} = require('./effects/process_meta_effects');
const {getDBType, setJSMemoryDBType} = require('./effects/app_effects');

const {executeChildProcessTask} = require('./effects/master_process_effects');
const {initModulesTraversingProcessQueue} = require('./effects/child_process_queue_effects');

// functions definition

// module implementation
//const pathToRootNodeModules1 = '/home/segei/projects/code_tests';
//const pathToRootNodeModules = '/home/segei/Downloads';
 //const pathToRootNodeModules = '/home/brightsign/projects/fatback/';
//const pathToRootNodeModules2 = '/home/brightsign/projects/fatback/bsCore';
// const pathToRootNodeModules = '/home/brightsign/projects/fatback/node_modules/bacon/node_modules/@brightsign/ba-dialog-ui/node_modules/@brightsign/ba-context-model/node_modules/@brightsign/bs-playlist-dm/node_modules/@brightsign/bscore/';


setMasterProcessType();
setJSMemoryDBType();

const b = generateSync(function* () {


    console.log('Open DB connection...');
    const dbType = getDBType();
    const dbConnection = yield getDBEffects(dbType).openConnectionToDB();
    yield getDBEffects(dbType).prepareDatabase(dbConnection);


    const pathsToTraverse = [
        /*"/home/brightsign/projects/fatback/bacon",
        "/home/brightsign/projects/fatback/bs-device-list-ui",
        "/home/brightsign/projects/fatback/bs-remote-dws",
        "/home/brightsign/projects/fatback/ba-presentation-edit-ui",
        "/home/brightsign/projects/fatback/ba-live-media-feed-edit-ui",
        "/home/brightsign/projects/fatback/ba-live-data-feed-edit-ui",
        "/home/brightsign/projects/fatback/ba-dynamic-playlist-edit-ui",
        "/home/brightsign/projects/fatback/ba-transfer-progress",
        "/home/brightsign/projects/fatback/ba-application-preference-ui",
        "/home/brightsign/projects/fatback/bs-device-setup-list-ui",
        "/home/brightsign/projects/fatback/bs-device-provision-ui",
        "/home/brightsign/projects/fatback/bs-user-management-ui",
        "/home/brightsign/projects/fatback/bs-permission-management-ui",
        "/home/brightsign/projects/fatback/bs-redux-enhancer",
        "/home/brightsign/projects/fatback/ba-dialog-ui",
        "/home/brightsign/projects/fatback/ba-notification-ui",
        "/home/brightsign/projects/fatback/bs-ts-components",
        "/home/brightsign/projects/fatback/bs-ts-widgets",
        "/home/brightsign/projects/fatback/bs-widgets",
        "/home/brightsign/projects/fatback/bacon-theme",
        "/home/brightsign/projects/fatback/ba-context-model",
        "/home/brightsign/projects/fatback/ba-schedule",
        "/home/brightsign/projects/fatback/ba-ipc-manager",
        "/home/brightsign/projects/fatback/bs-dws-manager",
        "/home/brightsign/projects/fatback/ba-uw-dm",
        "/home/brightsign/projects/fatback/ba-uw-manager",
        "/home/brightsign/projects/fatback/bs-autoplay-generator",
        "/home/brightsign/projects/fatback/bs-content-manager-store",
        "/home/brightsign/projects/fatback/bs-content-manager",
        "/home/brightsign/projects/fatback/bs-device-artifacts",
        "/home/brightsign/projects/fatback/bs-device-setup",
        "/home/brightsign/projects/fatback/bs-bpf-converter",
        "/home/brightsign/projects/fatback/bs-link-resolver",
        "/home/brightsign/projects/fatback/bs-permission-management-dm",
        "/home/brightsign/projects/fatback/bs-data-feed-dm",
        "/home/brightsign/projects/fatback/bs-playlist-dm",
        "/home/brightsign/projects/fatback/bs-publisher",
        "/home/brightsign/projects/fatback/bs-task-manager",
        "/home/brightsign/projects/fatback/bsDataModel",
        "/home/brightsign/projects/fatback/bs-lws-connector",
        "/home/brightsign/projects/fatback/bsnConnector",
        "/home/brightsign/projects/fatback/fsConnector",
        "/home/brightsign/projects/fatback/fsMetadata",*/
        "/home/brightsign/projects/fatback/bacon-core",
        "/home/brightsign/projects/fatback/bs-configurator",
        "/home/brightsign/projects/fatback/bsCore",
    ];

    initModulesTraversingProcessQueue(executeChildProcessTask(dbType, dbConnection), pathsToTraverse)
        .then(() => {
        });

    ////




    /*  console.log('Closing DB connection...');
      yield getDBEffects(dbType).closeConnectionToDB(dbConnection);*/
});

b();

