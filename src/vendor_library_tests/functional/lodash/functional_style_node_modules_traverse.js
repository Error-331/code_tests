'use strict';

// external imports

// local imports
const {generateSync} = require('./helpers/promise_sync_helpers');
const {getDBEffects} = require('./helpers/db_helpers');

const {setMasterProcessType} = require('./effects/process_meta_effects');
const {getDBType, setJSMemoryDBType} = require('./effects/app_effects');

const {executeChildProcessTask} = require('./effects/master_process_effects');
const {initModulesTraversingProcessQueue} = require('./effects/child_process_queue_effects');

// functions definition

// module implementation
//const pathToRootNodeModules1 = '/home/segei/projects/code_tests';
//const pathToRootNodeModules = '/home/segei/Downloads';
 //const pathToRootNodeModules = '/home/brightsign/projects/fatback/';
//const pathToRootNodeModules2 = '/home/brightsign/projects/fatback/bsCore';
// const pathToRootNodeModules = '/home/brightsign/projects/fatback/node_modules/bacon/node_modules/@brightsign/ba-dialog-ui/node_modules/@brightsign/ba-context-model/node_modules/@brightsign/bs-playlist-dm/node_modules/@brightsign/bscore/';

const pathToRootNodeModules1 = '/home/brightsign/projects/fatback/bsCore';
const pathToRootNodeModules2 = '/home/brightsign/projects/fatback/bsnConnector';

setMasterProcessType();
setJSMemoryDBType();

const b = generateSync(function* () {


    console.log('Open DB connection...');
    const dbType = getDBType();
    const dbConnection = yield getDBEffects(dbType).openConnectionToDB();
    yield getDBEffects(dbType).prepareDatabase(dbConnection);


    const pathsToTraverse = [pathToRootNodeModules1, pathToRootNodeModules2];

    initModulesTraversingProcessQueue(executeChildProcessTask(dbType, dbConnection), pathsToTraverse);

    ////




    /*  console.log('Closing DB connection...');
      yield getDBEffects(dbType).closeConnectionToDB(dbConnection);*/
});

b();

